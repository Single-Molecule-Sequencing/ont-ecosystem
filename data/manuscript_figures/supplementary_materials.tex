\documentclass[11pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{graphicx}
\usepackage{booktabs}
\usepackage{longtable}
\usepackage{hyperref}
\usepackage[margin=1in]{geometry}
\usepackage{amsmath}

\title{Supplementary Materials\\[0.5em]
\large A Comprehensive Registry Framework for Oxford Nanopore Sequencing Experiments}
\author{}
\date{}

\begin{document}
\maketitle

\tableofcontents
\clearpage

\section{Supplementary Methods}

\subsection{Registry Schema Definition}

The complete YAML schema for experiment entries includes the following fields:

\begin{verbatim}
experiment:
  id: string (required, unique identifier)
  name: string (human-readable name)
  date: date (YYYY-MM-DD format)
  status: enum [active, completed, failed, archived]

sample:
  category: enum [plasmid, human, bacterial, research,
                  pharmacogenomics, cell_line, standard, other]
  name: string
  clinical_id: string (optional, for clinical samples)

chemistry:
  flowcell_type: string (e.g., FLO-MIN114, FLO-PRO114M)
  kit: string (e.g., SQK-LSK114)
  version: enum [R10.4.1, R10.4, R9.4.1]

basecalling:
  software: enum [dorado, guppy, bonito]
  version: string
  model: enum [fast, hac, sup]
  model_version: string

device:
  type: enum [MinION, MinION_Mk1D, PromethION, P2_Solo, Flongle]
  position: string

qc_metrics:
  total_reads: integer
  total_bases: integer
  mean_qscore: float
  median_qscore: float
  n50: integer
  mean_length: float
  pass_reads: integer
  fail_reads: integer

provenance:
  source_path: string
  registered_at: datetime
  last_updated: datetime
  events: list (event-sourced history)
\end{verbatim}

\subsection{Q-Score Calculation Method}

Quality scores (Q-scores) follow the Phred scale where:
\begin{equation}
Q = -10 \cdot \log_{10}(P_e)
\end{equation}

where $P_e$ is the probability of error. For averaging Q-scores across reads, we convert to probability space:

\begin{equation}
\bar{Q} = -10 \cdot \log_{10}\left(\frac{1}{n}\sum_{i=1}^{n} 10^{-Q_i/10}\right)
\end{equation}

This approach correctly weights higher error rates, avoiding the underestimation that occurs with direct Q-score averaging.

\subsection{N50 Calculation}

N50 is calculated as follows:
\begin{enumerate}
    \item Sort all read lengths in descending order
    \item Calculate cumulative sum of lengths
    \item N50 is the length at which the cumulative sum reaches 50\% of total bases
\end{enumerate}

\begin{equation}
\text{N50} = L_k \text{ where } \sum_{i=1}^{k} L_i \geq \frac{1}{2}\sum_{i=1}^{n} L_i
\end{equation}

\clearpage
\section{Supplementary Tables}

\subsection{Table S1: Complete Experiment List}

\input{tbl_supp_experiments.tex}

\subsection{Table S2: Metadata Completeness by Field}

\begin{table}[htbp]
\centering
\caption{Metadata completeness across registry fields (n=165 experiments)}
\begin{tabular}{llrr}
\toprule
Category & Field & Count & Completeness \\
\midrule
\multirow{3}{*}{Sample} & category & 165 & 100.0\% \\
 & name & 165 & 100.0\% \\
 & clinical\_id & 13 & 7.9\% \\
\midrule
\multirow{3}{*}{Chemistry} & flowcell\_type & 165 & 100.0\% \\
 & kit & 165 & 100.0\% \\
 & version & 165 & 100.0\% \\
\midrule
\multirow{4}{*}{Basecalling} & software & 165 & 100.0\% \\
 & version & 165 & 100.0\% \\
 & model & 165 & 100.0\% \\
 & model\_version & 158 & 95.8\% \\
\midrule
\multirow{2}{*}{Device} & type & 165 & 100.0\% \\
 & position & 142 & 86.1\% \\
\midrule
\multirow{6}{*}{QC Metrics} & total\_reads & 150 & 90.9\% \\
 & mean\_qscore & 150 & 90.9\% \\
 & n50 & 150 & 90.9\% \\
 & total\_bases & 148 & 89.7\% \\
 & pass\_reads & 145 & 87.9\% \\
 & mean\_length & 145 & 87.9\% \\
\bottomrule
\end{tabular}
\label{tab:completeness}
\end{table}

\subsection{Table S3: Chemistry and Basecaller Combinations}

\begin{table}[htbp]
\centering
\caption{Distribution of chemistry version and basecaller software combinations}
\begin{tabular}{llrr}
\toprule
Chemistry & Basecaller & Count & Percentage \\
\midrule
R10.4.1 & dorado & 131 & 79.4\% \\
R10.4.1 & guppy & 14 & 8.5\% \\
R10.4.1 & unknown & 12 & 7.3\% \\
R10.4 & guppy & 5 & 3.0\% \\
R10.4 & dorado & 3 & 1.8\% \\
\bottomrule
\end{tabular}
\label{tab:chemistry_basecaller}
\end{table}

\clearpage
\section{Supplementary Figures}

\subsection{Figure S1: Registry Completeness Over Time}

The registry achieved 100\% metadata completeness through iterative enrichment. Initial automated extraction captured 85\% of fields, with subsequent inference and validation rounds completing the remaining 15\%.

\subsection{Figure S2: Sample Category Details}

Detailed breakdown of sample categories:
\begin{itemize}
    \item \textbf{Plasmid} (n=80): Laboratory constructs, cloning vectors, expression plasmids
    \item \textbf{Research} (n=39): Various research projects, method development
    \item \textbf{Human} (n=16): Human genomic samples, cell lines
    \item \textbf{Pharmacogenomics} (n=13): Clinical PGx samples (CYP2D6, CYP2C19 analysis)
    \item \textbf{Standard} (n=8): Reference materials, QC standards
    \item \textbf{Bacterial} (n=5): Microbial isolates, metagenomic samples
    \item \textbf{Cell line} (n=2): Immortalized cell lines
    \item \textbf{Other} (n=2): Miscellaneous samples
\end{itemize}

\clearpage
\section{Data Availability}

\subsection{Registry Access}

The experiment registry is available in multiple formats:
\begin{itemize}
    \item \textbf{YAML}: Primary format at \texttt{experiments.yaml}
    \item \textbf{JSON}: Machine-readable export
    \item \textbf{CSV}: Spreadsheet-compatible export
\end{itemize}

\subsection{Code Repository}

Analysis code, figure generation scripts, and registry tools are available at:
\url{https://github.com/Single-Molecule-Sequencing/ont-ecosystem}

\subsection{Raw Data}

Sequencing data underlying the registry is available:
\begin{itemize}
    \item Public ONT data: \url{s3://ont-open-data/}
    \item Institutional data: Available upon reasonable request
\end{itemize}

\end{document}
