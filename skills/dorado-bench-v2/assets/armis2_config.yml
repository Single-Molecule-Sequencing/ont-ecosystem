# ARMIS2 Configuration for Dorado Basecalling
# Advanced Research and Modeling Infrastructure System 2
# A40 GPU Cluster at University of Michigan

cluster: ARMIS2
cluster_type: hpc_armis2

# SLURM Configuration
slurm:
  partition: sigbio-a40
  account: bleu1  # Update with your account
  job_name_prefix: dorado_bench
  max_walltime: "144:00:00"
  max_gpus: 8
  max_memory: 100G
  max_cpus: 30

# GPU Resources
gpu:
  type: NVIDIA A40
  vram_per_gpu: 48GB
  compute_capability: 8.6
  recommended_devices: "cuda:all"
  
# File System Paths
paths:
  dorado_executable: /nfs/turbo/umms-bleu-secure/programs/dorado-1.1.1-linux-x64/bin/dorado
  models_directory: /nfs/turbo/umms-bleu-secure/programs/dorado_models
  input_base: /nfs/turbo/umms-bleu-secure/AGC_data
  output_base: /nfs/turbo/umms-bleu-secure/basecalled_AGC_data
  scratch_base: /nfs/turbo/umms-bleu-secure
  workspace: .

# Input POD5 Samples
# Specify your input directories here
samples: []
  # - /nfs/turbo/umms-bleu-secure/AGC_data/SAMPLE_1/RUN_ID/pod5
  # - /nfs/turbo/umms-bleu-secure/AGC_data/SAMPLE_2/RUN_ID/pod5

# Model Configuration
models:
  versions:
    - v5.2.0
    - v5.0.0
    - v4.3.0
  
  tiers:
    - fast
    - hac
    - sup
  
  # Modified bases to detect (optional)
  modified_bases: []
    # - 5mCG_5hmCG
    # - 6mA

# Trimming Configuration
trimming:
  enabled: true
  modes:
    - trim      # Trim barcodes and adapters
    - no-trim   # Keep original sequences

# Basecalling Options
basecalling:
  # Batch size - adjust based on GPU memory
  batch_sizes:
    fast: 4096
    hac: 2048
    sup: 1024
  
  # Chunk size for processing
  chunk_size: 10000
  
  # Sequencing kit (auto-detect if empty)
  kit_name: ""
  
  # Barcode kit (if different from sequencing kit)
  barcode_kit: ""
  
  # Output format
  output_format: bam
  
  # Minimum Q-score filter (0 = no filter)
  min_qscore: 0
  
  # Additional arguments
  additional_args: ""

# SLURM Resource Allocation by Model Tier
resources:
  fast:
    cpus: 16
    memory: 50G
    time: 24:00:00
    batch_size: 4096
  
  hac:
    cpus: 20
    memory: 75G
    time: 72:00:00
    batch_size: 2048
  
  sup:
    cpus: 30
    memory: 100G
    time: 144:00:00
    batch_size: 1024

# Email Notifications
notifications:
  enabled: true
  email: ""  # Your email address
  mail_type: "BEGIN,END,FAIL"

# Performance Benchmarking
benchmarking:
  enabled: true
  generate_statistics: true
  compare_versions: true
  compare_tiers: true
  compare_trim_modes: true
  
  output_directory: Results/
  metrics_file: performance_metrics.csv
  comparison_report: comparison_report.html

# Job Submission Strategy
submission:
  method: sequential  # sequential or array
  max_parallel_jobs: 8
  submit_delay_seconds: 5
  retry_on_failure: true
  max_retries: 3

# Logging and Monitoring
logging:
  log_directory: Logs/
  verbose: false
  monitor_interval_seconds: 30
  generate_summary: true

# Advanced Options
advanced:
  # Enable GPU compute mode
  gpu_compute_mode: exclusive_thread
  
  # Use NVLink for multi-GPU (if available)
  use_nvlink: false
  
  # CPU affinity
  cpu_affinity: enabled
  
  # Memory optimization
  memory_efficient_mode: false
  
  # Profile basecalling performance
  profile_performance: true
