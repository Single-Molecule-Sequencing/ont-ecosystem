# SMA-seq Experiment Configuration Index
# Generated: 2025-12-30
# Total experiments: 12

# Global settings
global:
  targets_file: "targets/sma_targets.yaml"
  default_kit: "SQK-NBD114-24"
  default_flow_cell: "FLO-MIN114"

# Experiment registry
experiments:
  # ============================================
  # Priority: Recent December 2025 (Double Barcode)
  # ============================================

  - id: "12282025_IF_DoubleBC_SMA_seq"
    config: "experiments/12282025_IF_DoubleBC_SMA_seq.yaml"
    date: "2025-12-28"
    type: "double_barcode"
    size_gb: 7.6
    status: "ready"
    priority: 1

  - id: "12282025_IF_DoubleBC_SMA_seq_no_trim"
    config: "experiments/12282025_IF_DoubleBC_SMA_seq_no_trim.yaml"
    date: "2025-12-28"
    type: "double_barcode_no_trim"
    size_gb: 137
    status: "ready"
    priority: 1
    paired_with: "12282025_IF_DoubleBC_SMA_seq"

  - id: "12232025_IF_DoubleBC_SMA_seq"
    config: "experiments/12232025_IF_DoubleBC_SMA_seq.yaml"
    date: "2025-12-23"
    type: "double_barcode"
    size_gb: 358
    status: "ready"
    priority: 2

  # ============================================
  # Priority: December 18 Replicates
  # ============================================

  - id: "12182025_IF_NewBCPart4_Ex1_SMA_seq"
    config: "experiments/12182025_IF_NewBCPart4_Ex1_SMA_seq.yaml"
    date: "2025-12-18"
    type: "new_barcode_part4"
    size_gb: 81
    status: "ready"
    priority: 3
    replicate_group: "12182025_NewBCPart4"
    replicate: 1

  - id: "12182025_IF_NewBCPart4_Ex2_SMA_seq"
    config: "experiments/12182025_IF_NewBCPart4_Ex2_SMA_seq.yaml"
    date: "2025-12-18"
    type: "new_barcode_part4"
    size_gb: 55
    status: "ready"
    priority: 3
    replicate_group: "12182025_NewBCPart4"
    replicate: 2

  - id: "12182025_IF_NewBCPart4_Ex3_SMA_seq"
    config: "experiments/12182025_IF_NewBCPart4_Ex3_SMA_seq.yaml"
    date: "2025-12-18"
    type: "new_barcode_part4"
    size_gb: 74
    status: "ready"
    priority: 3
    replicate_group: "12182025_NewBCPart4"
    replicate: 3

  # ============================================
  # Priority: Early December / November
  # ============================================

  - id: "12082025_IF_NewBCPart4_SMA_seq"
    config: "experiments/12082025_IF_NewBCPart4_SMA_seq.yaml"
    date: "2025-12-08"
    type: "new_barcode_part4"
    size_gb: 294
    status: "ready"
    priority: 4

  - id: "11242025_IF_Part4_SMA_seq"
    config: "experiments/11242025_IF_Part4_SMA_seq.yaml"
    date: "2025-11-24"
    type: "part4"
    size_gb: 431
    status: "ready"
    priority: 5
    notes: "Largest dataset - 17 barcodes"

  - id: "11242025_IF_Part4_CIP_Treated_SMA_seq"
    config: "experiments/11242025_IF_Part4_CIP_Treated_SMA_seq.yaml"
    date: "2025-11-24"
    type: "part4_cip"
    size_gb: 0.5
    status: "ready"
    priority: 5
    paired_with: "11242025_IF_Part4_SMA_seq"
    treatment: "CIP"

  # ============================================
  # Legacy: Pilot/Early Development
  # ============================================

  - id: "081920205_IF_Pilot_SMA_seq"
    config: "experiments/081920205_IF_Pilot_SMA_seq.yaml"
    date: "2025-08-19"
    type: "pilot"
    size_gb: 0.7
    status: "needs_review"
    priority: 10
    notes: "Pilot - different barcode scheme (V015-V023)"

  - id: "IF_SMAseq_09112025"
    config: "experiments/IF_SMAseq_09112025.yaml"
    date: "2025-09-11"
    type: "early_test"
    size_gb: 0.8
    status: "needs_review"
    priority: 10

  - id: "IF_SMAseq_9_11_continuted"
    config: "experiments/IF_SMAseq_9_11_continuted.yaml"
    date: "2025-09-15"
    type: "early_test"
    size_gb: 0.3
    status: "needs_review"
    priority: 10
    continuation_of: "IF_SMAseq_09112025"

# Target sequence status
targets:
  complete:
    - V0-4.1
    - V0-4.2
    - V0-4.3
    - V0-4.4
    - V0-39
    - V0-40
    - V0-41
    - V0-42
    - V0-43
    - V0-44
    - V0-45
    - V0-46
    - V0-47
    - V0-4.14
    - V0-4.15
    - V0-4.16
    - V0-4.17
    - B2

  pending_sequences:
    - V0-15  # CYP2D6:3909-4007 (99bp) - used in pilot experiments
    - V0-16  # CYP2D6:4004-4115 (112bp)
    - V0-17  # CYP2D6:4112-4201 (90bp)
    - V0-18  # CYP2D6:4198-4312 (115bp)
    - V0-19  # CYP2D6:4309-4423 (115bp)
    - V0-20  # CYP2D6:4420-4507 (88bp)
    - V0-21  # CYP2D6:4504-4609 (106bp)
    - V0-22  # CYP2D6:4606-4705 (100bp)
    - V0-23  # CYP2D6:4702-4802 (101bp)

# =============================================================================
# PROOF-OF-PRINCIPLE EXPERIMENTS (Great Lakes HPC)
# =============================================================================
proof_of_principle:
  location: Great Lakes HPC
  base_path: /nfs/turbo/umms-atheylab/gregfar/SMS/
  index: experiments/proof_of_principle/INDEX.yaml
  status: configs_created
  note: "Verify paths on Great Lakes before use"

  experiments:
    - id: cas9_exon2_SMS
      category: cas9_cutting
      reads: ~59000
      device: MinION

    - id: eco53kI_SMS
      category: restriction_enzyme
      reads: ~213000
      device: MinION

    - id: pCYP_proteinaseK_SMS
      category: enzyme_treatment
      sub_experiments: 4
      device: MinION

    - id: rapid_barcode_plasmid_24_SMS
      category: rapid_barcoding
      sub_experiments: 3
      device: MinION

    - id: cutting_SRF1_SMS
      category: restriction_enzyme
      device: PromethION

    - id: cutting_PVU2_SMS
      category: restriction_enzyme
      device: PromethION

    - id: cutting_Regular_SMS
      category: control
      device: PromethION

# Summary statistics
summary:
  total_experiments: 12
  proof_of_principle_experiments: 7
  total_size_tb: 1.44
  ready_configs: 9
  needs_review: 3
  targets_defined: 27
  targets_with_sequences: 18
  targets_pending_sequences: 9

# =============================================================================
# ANALYSIS RESULTS SUMMARY (2025-12-30)
# =============================================================================
analysis_summary:
  analyzed_date: '2025-12-30'

  by_status:
    clean: 1           # 12282025_IF_DoubleBC_SMA_seq
    daisy_chains: 2    # 12232025, 11242025_IF_Part4
    severe_daisy_chains: 1  # 12082025
    anomalous: 3       # 12182025 Ex1, Ex2, Ex3
    failed: 1          # 11242025_CIP
    not_analyzed: 4    # Pilot experiments

  experiments:
    - id: "12282025_IF_DoubleBC_SMA_seq"
      status: clean
      n50_bp: 149
      mean_qscore: 11.9
      total_reads: 1445165
      verdict: "SUCCESS - Odd/even fix validated"

    - id: "12232025_IF_DoubleBC_SMA_seq"
      status: daisy_chains
      n50_bp: 2613
      mean_qscore: 14.1
      total_reads: 12074175
      verdict: "Bimodal distribution, daisy chains present"

    - id: "11242025_IF_Part4_SMA_seq"
      status: daisy_chains
      n50_bp: 2639
      mean_qscore: 15.6
      total_reads: 20062441
      verdict: "Largest dataset, daisy chains present"

    - id: "12082025_IF_NewBCPart4_SMA_seq"
      status: severe_daisy_chains
      n50_bp: 5400
      mean_qscore: 12.2
      total_reads: 4688237
      verdict: "Severe artifacts with new 3-step protocol"

    - id: "12182025_IF_NewBCPart4_Ex1_SMA_seq"
      status: anomalous
      n50_bp: 116800
      mean_qscore: 6.7
      total_reads: 3228363
      verdict: "Hi-T4 ligase - extreme long reads, low quality"

    - id: "12182025_IF_NewBCPart4_Ex2_SMA_seq"
      status: anomalous
      n50_bp: 332500
      mean_qscore: 6.3
      total_reads: 1784271
      verdict: "Immobilized T4 - worst N50, lowest quality"

    - id: "12182025_IF_NewBCPart4_Ex3_SMA_seq"
      status: anomalous
      n50_bp: 140100
      mean_qscore: 7.0
      total_reads: 2200586
      verdict: "Separate tubes - similar anomalous pattern"

    - id: "11242025_IF_Part4_CIP_Treated_SMA_seq"
      status: failed
      n50_bp: null
      mean_qscore: null
      total_reads: 0
      verdict: "No data - CIP killed helicase activity"

  key_findings:
    - "Odd/even plasmid separation eliminates daisy chaining (Dec 28 vs Dec 23)"
    - "All Dec 18 cycling protocol variants failed with extreme artifacts"
    - "Standard 5-step and new 3-step protocols both produce daisy chains"
    - "Only successful clean library: V0-4.2 and V0-4.4 only (even-numbered)"

# Protocol evolution and lessons learned
protocols:
  standard_5step:
    description: "Original SMA-seq protocol"
    steps: ["BsaI digestion", "End repair", "dA tailing", "Barcode ligation", "Adapter ligation"]
    used_in: ["11242025_IF_Part4_SMA_seq", "11242025_IF_Part4_CIP_Treated_SMA_seq"]

  new_barcode_3step:
    description: "Simplified protocol with new custom barcodes"
    steps: ["BsaI digestion", "New barcode ligation (100nM)", "Adapter ligation"]
    used_in: ["12082025_IF_NewBCPart4_SMA_seq"]

  cleavage_ligation_cycling:
    description: "One-tube cleavage-ligation cycling protocol"
    cycling: "37C 10min -> (37C 3min / 16C 3min) x10 -> 37C 15min"
    variants:
      - one_tube_HiT4: "Hi-T4 DNA Ligase, upstream barcode only"
      - one_tube_immobilized: "Immobilized T4 DNA Ligase, both ends"
      - separate_tubes: "Each plasmid in separate tube, then pooled"
    used_in: ["12182025 replicates", "12232025_IF_DoubleBC_SMA_seq"]

# Lessons learned from new barcode experiments
lessons_learned:
  date_documented: "2025-12-23"
  documented_by: "Isaac Farnum"

  issue_daisy_chaining:
    description: "Daisy chaining observed in new barcode experiments"
    symptoms:
      - "Much more daisy chaining seen"
      - "Barcodes with adapters seen attached to backbone"
    root_cause: |
      The backbone left behind from adjacent Level 0 plasmids presents
      a perfect match for other barcodes in the Golden Gate scheme.
    affected_experiments:
      - "12082025_IF_NewBCPart4_SMA_seq"
      - "12182025_IF_NewBCPart4_Ex1_SMA_seq"
      - "12182025_IF_NewBCPart4_Ex2_SMA_seq"
      - "12182025_IF_NewBCPart4_Ex3_SMA_seq"
      - "12232025_IF_DoubleBC_SMA_seq"

  fix_odd_even_separation:
    description: "Use only odd or even numbered Level 0 plasmids per experiment"
    rationale: |
      By separating odd and even numbered Level 0 plasmids,
      adjacent plasmids in the Golden Gate scheme are not present together.
      This prevents the backbone matching issue.
    recommendation: |
      Future double-barcoded SMA-seq experiments should include:
      - Odd-only: V0-4.1, V0-4.3, V0-39, V0-41, V0-43, V0-45, V0-47
      - Even-only: V0-4.2, V0-4.4, V0-40, V0-42, V0-44, V0-46

# =============================================================================
# CUSTOM BARCODE INVENTORY
# =============================================================================
custom_barcode_inventory:
  available:
    forward: [NB01, NB02, NB03, NB04, NB05]  # V0-4.1 to V0-4.4, V0-39
    reverse: [NB06, NB07, NB08, NB09, NB10]  # Mostly for V0-4.2 and V0-4.4

  coverage_status:
    fully_covered: [V0-4.2, V0-4.4]  # Both forward and reverse barcodes
    forward_only: [V0-4.1, V0-4.3, V0-39]  # Need reverse barcodes
    standard_ont_only: [V0-39 to V0-47, V0-4.14 to V0-4.17]

  pending:
    - "Reverse barcodes for V0-4.1, V0-4.3, V0-39"
    - "Custom barcodes for V0-39 through V0-47 series"

# =============================================================================
# REFERENCE FILES GENERATED
# =============================================================================
reference_files:
  generator_script: "generate_all_references.py"
  expected_products_spec: "targets/expected_products.yaml"
  output_types:
    - "reference.fa - Clean expected products (main reference)"
    - "reference_targets.fa - Target sequences only (for post-demux alignment)"
    - "reference_artifacts.fa - Daisy chain artifact sequences for QC"

  output_locations:
    - "experiments/<exp_id>/references/reference.fa"
    - "experiments/<exp_id>/references/reference_targets.fa"
    - "experiments/<exp_id>/references/reference_artifacts.fa"

# =============================================================================
# EXPECTED PRODUCTS AND PEAKS
# =============================================================================
expected_products:
  spec_file: "targets/expected_products.yaml"

  peak_categories:
    clean_products:
      length_range_bp: [100, 260]
      description: "Single-target amplicons with correct barcode"
      observed_in: "12282025_IF_DoubleBC_SMA_seq (N50=149bp)"

    daisy_chains:
      length_range_bp: [2300, 3000]
      description: "Single daisy chain (TARGET + BACKBONE + TARGET)"
      observed_in: "11242025, 12232025 experiments"

    multi_daisy_chains:
      length_range_bp: [4500, 8000]
      description: "Multiple concatenated daisy chains"
      observed_in: "12082025_IF_NewBCPart4_SMA_seq (N50=5400bp)"

    anomalous:
      length_range_bp: [100000, 500000]
      description: "Extreme artifacts (gDNA contamination or undigested plasmid)"
      observed_in: "12182025 replicates (N50=116-332K bp)"
